<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Animations&Interceptors Exercise</title>
    <base href="/">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="stylesheet" type="text/css"
        href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://bootswatch.com/4/lux/bootstrap.min.css">

</head>

<style>
    #notifications {
        float: right;
        position: absolute;
        top: 0;
        right: 0;
        text-align: center;
        margin: 1em;
    }

    .notification {
        font-size: 1.5em;
        color: #ffffff;
        display: none;
        text-align: right;
    }

    .notification>span {
        display: inline-block;
        padding: 0.5em 2em 0.5em 2em;
        border-radius: 10px;
    }

    #loadingBox>span {
        background: #7CB3E9;
    }

    #infoBox>span {
        background: #393;
    }

    #errorBox>span {
        background: #F50;
    }
</style>

<style>
    body {

        font-size: 16px;
        padding: 50px 20px;
        box-sizing: border-box;
    }

    .display-none-container {
        display: none;
    }


    .main-navigation__ul {
        list-style: none;
        display: flex;
        justify-content: center;
    }

    .main-navigation__ul li {
        margin-right: 50px;
    }
</style>

<body id="main">
    <nav class="main-navigation">
        <ul class="main-navigation__ul">
            <li><a href="home">Home</a></li>
            <li><a href="create">Create</a></li>
            <li><a href="profile">Profile</a></li>
        </ul>
    </nav>
    <div id="container">
        <div class="container create-container display-none-container">
            <div class="row space-top">
                <div class="col-md-12">
                    <h1>Create New Furniture</h1>
                    <p>Please fill all fields.</p>
                </div>
            </div>
            <form>
                <div class="row space-top">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="form-control-label" for="new-make">Make</label>
                            <input class="form-control" id="new-make" type="text">
                        </div>
                        <div class="form-group has-success">
                            <label class="form-control-label" for="new-model">Model</label>
                            <input class="form-control is-valid" id="new-model" type="text">
                            <div class="form-control-feedback">This input value is valid</div>
                        </div>
                        <div class="form-group has-danger">
                            <label class="form-control-label" for="new-year">Year</label>
                            <input class="form-control is-invalid" id="new-year" type="number">
                            <div class="form-control-feedback">This input value is invalid</div>
                        </div>
                        <div class="form-group">
                            <label class="form-control-label" for="new-description">Description</label>
                            <input class="form-control" id="new-description" type="text">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="form-control-label" for="new-price">Price</label>
                            <input class="form-control" id="new-price" type="number">
                        </div>
                        <div class="form-group">
                            <label class="form-control-label" for="new-image">Image</label>
                            <input class="form-control" id="new-image" type="text">
                        </div>
                        <div class="form-group">
                            <label class="form-control-label" for="new-material">Material (optional)</label>
                            <input class="form-control" id="new-material" type="text">
                        </div>
                        <input type="submit" class="btn btn-primary" value="Create" />
                    </div>
                </div>
            </form>
        </div>
        <div class="container home-container display-none-container">
            <div class="container">
                <div class="row space-top">
                    <div class="col-md-12">
                        <h1>Welcome to Furniture System</h1>
                    </div>
                </div>
            </div>
            <div class="home-furniture-wrapper"></div>
        </div>
        <div class="container profile-container display-none-container">
            <div class="row space-top">
                <div class="col-md-12">
                    <h1>Profile Page</h1>
                    <p>Listing your furniture.</p>
                </div>
            </div>
            <div class="row space-top">
                <div class="col-md-4">
                    <div class="card text-white bg-primary">
                        <div class="card-body">
                            <blockquote class="card-blockquote">
                                <img src="" />
                                <p>Description Here</p>
                                <footer>Someone famous in
                                    <cite title="Source Title">Source Title</cite>
                                </footer>
                                <div class="pull-right">
                                    <a href=”#” class="btn btn-info">Details</a>
                                    <a href=”#” class="btn btn-danger">Delete Item</a>
                                </div>
                            </blockquote>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="notifications display-none-container">
            <div id="loadingBox" class="notification">
                <span>Loading …</span>
            </div>
            <div id="infoBox" class="notification">
                <span>Info</span>
            </div>
            <div id="errorBox" class="notification">
                <span>Error</span>
            </div>
        </div>

        <script>

            const getDomElement = {

                navList: () => document.querySelector('.main-navigation__ul'),
                infoContainers: () => [document.querySelector('.home-container'), document.querySelector('.profile-container'), document.querySelector('.create-container')],
                homeDivContainer: () => document.querySelector('.home-container'),
                profileDivContainer: () => document.querySelector('.profile-container'),
                createDivContainer: () => document.querySelector('.create-container'),
                createFurnitureBtn: () => document.querySelector('.create-container .btn'),
                inputFurnitureName: () => document.querySelector('#new-make'),
                inputFurnitureModel: () => document.querySelector('#new-model'),
                inputFurnitureYear: () => document.querySelector('#new-year'),
                inputFurnitureDescription: () => document.querySelector('#new-description'),
                inputFurniturePrice: () => document.querySelector('#new-price'),
                inputFurnitureImageURL: () => document.querySelector('#new-image'),
                inputFurnitureMaterial: () => document.querySelector('#new-material'),
                furnitureWrapper: () => document.querySelector('.home-furniture-wrapper'),
            }

            getDomElement['navList']().addEventListener('click', routeOnClick);
            getDomElement['createFurnitureBtn']().addEventListener('click', createFurniture);
            window.addEventListener('popstate', () => {

                hideAllInfoContainers();

                let path = location.pathname;

                switch (path) {

                    case '/home': {
                        getDomElement['furnitureWrapper']().innerHTML = '';
                        getDomElement['homeDivContainer']().classList.remove('display-none-container');
                        loadAllFurnitures();
                        break;
                    }

                    case '/profile': {
                        getDomElement['profileDivContainer']().classList.remove('display-none-container');
                        break;
                    }

                    case '/create': {
                        getDomElement['createDivContainer']().classList.remove('display-none-container');
                        break;
                    }
                }
            })
            
            const baseURL = 'https://testproject-329ca-default-rtdb.firebaseio.com/furnitures';

            function loadDetails(e) {

                e.preventDefault();
                const {key} = e.target.dataset;

                if(!key) return;

                const detailsContainer = document.querySelector(`div[data-key="${key}"]`);

                if((e.target.innerText).toLowerCase() == 'details') {
                detailsContainer.classList.remove('display-none-container');
                e.target.innerText = 'Hide Details';

                } else {
                    e.target.innerText = 'Details';
                     detailsContainer.classList.add('display-none-container');

                }
            }

            function loadAllFurnitures() {
                      
                fetch(`${baseURL}.json`)
                .then(res => res.json())
                .then(data => {
                    
                    console.log(data);
                    Object.keys(data).forEach(key => {

                       let {name, model, imageURL, price, description, year, material} = data[key];

                       getDomElement['furnitureWrapper']().innerHTML +=  `<div class="row space-top">
                    <div class="col-md-4">
                        <div class="card text-white bg-primary">
                            <div class="card-body">
                                <blockquote class="card-blockquote">
                                    <img src=${imageURL} />
                                    <p>Description here</p>
                                    <footer>Someone famous in
                                        <cite title="Source Title">Source Title</cite>
                                    </footer>
                                    <div class="pull-right">
                                        <a href=”#” class="btn btn-info" data-key="${key}" onclick="loadDetails(event);">Details</a>
                                    </div>
                                </blockquote>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="container display-none-container" data-key="${key}">
                <div class="row space-top">
                    <div class="col-md-12">
                        <h1>Furniture Details</h1>
                    </div>
                </div>
                <div class="row space-top">
                    <div class="col-md-4">
                        <div class="card text-white bg-primary">
                            <div class="card-body">
                                <blockquote class="card-blockquote">
                                    <img src="${imageURL}" />
                                </blockquote>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <p>Make: ${name}</p>
                        <p>Model: ${model}</p>
                        <p>Year: ${year}</p>
                        <p>Description: ${description}</p>
                        <p>Price: ${price}</p>
                        <p>Material: ${material}</p>
                    </div>
                </div>
            </div>
            `
                    
                       })
                      
                })
                .catch(console.error());
            }

            function createFurniture(e) {

                e.preventDefault();

                const createURL = `${baseURL}.json`;

                let furnitureName = getDomElement['inputFurnitureName']().value;
                let furnitureModel = getDomElement['inputFurnitureModel']().value;
                let furnitureYear = getDomElement['inputFurnitureYear']().value;
                let furnitureDescription = getDomElement['inputFurnitureDescription']().value;
                let furniturePrice = getDomElement['inputFurniturePrice']().value;
                let furnitureImageURL = getDomElement['inputFurnitureImageURL']().value;
                let furnitureMaterial = getDomElement['inputFurnitureMaterial']().value;

                clearInputValues([
                    getDomElement['inputFurnitureName'](),
                    getDomElement['inputFurnitureModel'](),
                    getDomElement['inputFurnitureYear'](),
                    getDomElement['inputFurnitureDescription'](),
                    getDomElement['inputFurniturePrice'](),
                    getDomElement['inputFurnitureImageURL'](),
                    getDomElement['inputFurnitureMaterial']()
                ])

                let bodyJsonObj = JSON.stringify(
                    {
                        "name": furnitureName,
                        "model": furnitureModel,
                        "year": furnitureYear,
                        "description": furnitureDescription,
                        "price": furniturePrice,
                        "imageURL": furnitureImageURL,
                        "material": furnitureMaterial
                    }
                )

                let methodObj = {
                    method: "POST",
                    body: bodyJsonObj
                }

                fetch(createURL, methodObj)
                    .then(res => {
                        history.pushState({}, '', '/home');
                        router();
                    })
                    .catch(console.error());

            }

            function routeOnClick(e) {

                e.preventDefault();

                if (e.target.tagName !== 'A') {
                    return;
                }

                const { target } = e;

                console.log(target.href);
                history.pushState({}, '', target.href);

                router();
            }

            function router() {

                const event = new CustomEvent('popstate');

                window.dispatchEvent(event);

            }

            function hideAllInfoContainers() {

                let divInfoCollection = getDomElement['infoContainers']();

                divInfoCollection.forEach(div => div.classList.add('display-none-container'));

            }

            function clearInputValues(arrayOfInputElements) {

                arrayOfInputElements.forEach(inputElement => inputElement.value = '');
            }

        </script>

</body>

</html>